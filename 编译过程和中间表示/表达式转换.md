# 表达式转换

经过编译变换得到的中间表示保护的构造，如果直接转换为javascript，那么，如果在那些将要转换成javascript表达式的构造中含有语句，将产生不符合javascript要求的代码。因此，编译器通过表达式转换这个步骤重新安排这些构造，以获得一个合乎目标语言要求的形式。

很自然可能会有人产生一个疑问：为什么先进行表达式转换，而不是编译优化？难道表达式转换不应该最靠近代码产生这个步骤吗？这是因为表达式转换过程中，将产生一些临时变量及其赋值语句。将表达式转换步骤放在前面，可以借助随后的编译优化步骤消除掉不必要的变量和赋值。

根据我的研究，在处理表达式转换这个问题上，其它一些语言采用的方法一般是这样的：对某些简单的特殊情况，比如将if语句赋值给某个变量，将赋值移到if语句的两个分支当中。而对其它一些更复杂的情况，则采用如下方法解决：将语句封包成函数调用之中。这种方法的一个问题是会引入函数调用的开销，另一个显而易见的问题是无法处理return语句，也无法处理break或continure语句需要跳转到封包函数之外的情形。coffee-script采用了这种方法。虽然比较而言它已经很广泛地支持将语句转换为表达式，但依然不允许将break，return语句使用在表达式构造中。

太极语言没有采用上述方法。它进行表达式变化的基本思路是：将所有构造分离成两部分：语句部分和表达式部分，然后再加以重新组合。这是一个很通用的设计，可以一致的处理任何语句的表达式转换。当然，转换过程必须确保语义的正确，而副作用是其中需要考虑的重点问题。
