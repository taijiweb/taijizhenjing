# 代码产生

通过编译优化，得到了优化以后的中间表示。下一步，编译系统将依据这个中间表示执行代码产生步骤，产生最终的目标代码。这个步骤又被细分为两个小的步骤：第一步，产生标记项序列。第二步：产生代码文本。

先介绍第一步，产生标记项序列。这个步骤从优化的中间表示产生一个可以直接文本化的标记项数组。这个步骤的基本算法是：如果中间表示不是数组或者是空数组，那么直接产生合适的目标javascirpt代码的字符串表示。否则，根据数组的第一项执行对应的转换。比如，当第一项是`"binary!"`, 将产生组成二元运算的左操作数，运算符和右操作数三项组成的标记数组。如果是`"if", 则将产生能够通过文本化步骤转换成if语句的标记项数组。如此等等。

标记项数组中可以包含不同的标记项：每一项可以是数组，字符串，或者是带有类型记号的一个json对象。标记的类型记号包括`PAREN`，`BRACKET`，`BINARY`，`LIST`，`BLOCK`，`STATEMENT`，`FUNCTION`以及其它常数值。这组值可以在下一步用于指示文本化的动作。

再来看产生代码文本这个步骤。这是一个简单直接的步骤，直接依据据标记项数组转换为最终的代码文本。对于标记项中的每一项，如果是字符串则直接连接到目标文本，如果是数组则按次序依次转换所包含的每一项，如果是json对象，则依据其中的类型记号进行指定的转换。